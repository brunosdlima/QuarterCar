clc
clear all

%Incremento
incremento=0.01;   %Passo de tempo da simulação
Vini=0;            %Velocidade inicial do veiculo
tmintroca=3.0;     %Tempo minimo q a marcha permanece engatada sem troca

%Dados motor 1
Rot=[1500 1750 2000 2250 2500 2750 3000 3250 3500 3750 4000 4250 4500 4750 5000 5250 5500 5750 6000 6250 6500];
Pot=[16.4 19.5 21.9 25.7 29.7 32.8 36.0 38.8 41.4 44.1 47.9 51.9 54.7 57.1 59.2 60.9 61.1 60.9 59.8 59.7 59.3];
Tor=[7.83 7.98 7.84 8.18 8.51 8.54 8.59 8.55 8.47 8.42 8.58 8.75 8.71 8.61 8.48 8.31 7.96 7.59 7.14 6.84 6.53];
Nmin=1500;      %Rotação mínima
Nmax=6500;      %Rotação máxima
Rcortesup=6000; %Rotação para troca de marcha
Rcorteinf=2000; %Rotação para troca de marcha

%Parâmetros de Trasnmissao
ttroca=1.0;                                              %Tempo gasto na troca de marcha
M1=4.273;M2=2.238;M3=1.444;M4=1.029;M5=0.838;M6=0.838;   %Relação de marchas
Md=4.067;                                                %redução diferencial
Ni=0.94;                                                 %eficiencia da caixa

%Embreagem
tefmax=0.5;                          %Tempo gasto para embreagem acoplar perfeitamente

i=1;n=0;temb1(1)=0;
for n = 0:incremento:ttroca-incremento
    i = i+1;
    tembc1(i-1)=0;
    tembc1(i)=0;
    temb1(i)=temb1(i-1) + incremento;
end
tembc2=[incremento:incremento:tefmax];
temb2=[ttroca+incremento:incremento:tefmax+ttroca];
tembc=[tembc1,tembc2];
temb=[temb1,temb2];                 %Tempo gasto ate o acoplamento final
%efemb=log10(1+((9/tefmax)*tembc));  %Eficiencia da emberagem ate o acoplamento final
efemb=[1+cos(-pi+pi*tembc/tefmax)]/2; % nova curva com cosseno
 
%Parametros de pneu
rd=0.274;
aderest=0.88;
aderdin=0.8;

%gravidade
g=9.81;

%Parâmetros do veículo
m=825;
F0=96.9;
F2=0.502;
Nfr=0.6*m*g;
%Parametros de pista
teta=0; %angulo de inclinação

% densidade do combustivel
ro=0.752; %g/cm³
% %combustível gasolina= 13:1 de ar
% rmassa=1/14; %g/g
% %consumo por rotação, chutando motor 4 tempos, 2.0
% cpr=6.69; %g
% %consumo específico
% %cesp=cpr*60*Rot/(Pot*1000)   Kg/CVh
% cesp=[36.713 36.023 36.657 35.142 33.788 33.654 32.722 33.622 33.935 34.133 33.520 32.870 33.022 33.391 33.902 34.603 36.133 37.899 40.274 42.022 43.998];
% figure(1);plot(Rot,cesp,'k',Rot,Pot,'b',Rot,Tor,'m')
Rot2=[6500 6500 6500 6500 6500 6500 6500 6500 6000 6000 6000 6000 6000 6000 6000 6000 6000 5750 5750 5750 5750 5750 5750 5750 5750 5750 5500 5500 5500 5500 5500 5500 5500 5500 5500 5250 5250 5250 5250 5250 5250 5250 5250 5250 5000 5000 5000 5000 5000 5000 5000 5000 5000 4500 4500 4500 4500 4500 4500 4500 4500 4500 4000 4000 4000 4000 4000 4000 4000 4000 4000 3750 3750 3750 3750 3750 3750 3750 3750 3750 3500 3500 3500 3500 3500 3500 3500 3500 3500 3000 3000 3000 3000 3000 3000 3000 3000 3000 2750 2750 2750 2750 2750 2750 2750 2750 2750 2500 2500 2500 2500 2500 2500 2500 2500 2500 2250 2250 2250 2250 2250 2250 2250 2250 2250 2000 2000 2000 2000 2000 2000 2000 2000 2000 2000 1750 1750 1750 1750 1750 1750 1750 1750 1750 1750 1500 1500 1500 1500 1500 1500 1500 1500 1500];
Pot2=[50.6 44 35.2 26 16.9 12.8 8.4 2.7 53.2 47.2 38.3 29 20.5 16.2 11.1 7.6 2.3 53.5 47.5 38.9 29.1 21.2 19.3 12.1 7.3 3.1 52.9 46.8 38.5 30 21.3 17.1 13 8.8 5.3 51.1 45.1 37.3 29.2 21.1 17.2 12.5 9.1 4.6 49 42.9 35.5 27.6 19.8 16.5 13.3 8.7 5.2 46.5 40.5 33.1 26.3 19.3 15.4 12.2 8.2 5.5 41.7 35.2 29.3 23.5 16.9 14.1 11.3 8.2 4.9 37.9 32.5 27.1 21.6 15.8 13.4 10 6.7 3.6 33.6 28.7 24 19.5 14.1 11 8.7 6 3 31.3 26.7 22.2 17.8 13 10.8 8.4 6.1 3.7 28.7 24.1 20 16.4 12 10.1 8 5.6 3.6 26.1 21.6 18.2 14.3 10.7 8.5 6.9 5.2 3.5 21.5 18.1 15.1 11.9 8.8 7.1 5.5 4.2 2.5 19.5 18.9 16.5 13.8 10.9 8.4 6.6 5.6 3.9 2.5 17.1 16.8 14.7 12.2 10.2 7.5 6.3 4.9 3.9 2.5 15.1 14.6 12.6 10.6 8.5 6.2 5.1 4.1 3.1];
Consumo=[16.78145695364 14.58278145695 11.94701986755 10.23841059603 8.07947019868 7.03311258278 6.23841059603 5.11258278146 16.83443708609 14.94039735099 12.42384105960 10.14569536424 8.37086092715 7.41721854305 6.56953642384 5.56291390728 4.52980132450 16.70198675497 14.83443708609 12.34437086093 9.93377483444 8.11920529801 7.72185430464 6.23841059603 5.12582781457 4.30463576159 16.52980132450 14.58278145695 11.68211920530 9.80132450331 7.73509933775 6.84768211921 5.97350993377 5.23178807947 4.50331125828 15.62913907285 13.57615894040 11.28476821192 9.19205298013 7.52317880795 6.56953642384 5.61589403974 4.87417218543 3.93377483444 15.00662251656 12.86092715232 10.75496688742 8.71523178808 7.03311258278 6.33112582781 5.43046357616 4.51655629139 3.94701986755 13.50993377483 11.50993377483 9.64238410596 8.07947019868 6.49006622517 5.69536423841 5.17880794702 4.23841059603 3.65562913907 12.14569536424 9.77483443709 8.42384105960 7.08609271523 5.72185430464 5.20529801325 4.64900662252 3.96026490066 3.24503311258 10.64900662252 8.91390728477 7.60264900662 6.37086092715 5.20529801325 4.80794701987 4.06622516556 3.39072847682 2.82119205298 9.17880794702 7.74834437086 6.63576158940 5.66887417219 4.58278145695 4.06622516556 3.73509933775 2.92715231788 2.31788079470 8.82119205298 7.47019867550 6.35761589404 5.20529801325 4.19867549669 3.74834437086 3.28476821192 2.76821192053 2.27814569536 8.15894039735 6.55629139073 5.52317880795 4.63576158940 3.74834437086 3.44370860927 2.95364238411 2.43708609272 2.07947019868 7.33774834437 5.82781456954 4.99337748344 4.07947019868 3.36423841060 2.90066225166 2.86092715232 2.50331125828 2.01324503311 6.05298013245 4.83443708609 4.15894039735 3.45695364238 3.04635761589 2.56953642384 2.17218543046 1.89403973510 1.53642384106 5.64238410596 5.13907284768 4.46357615894 3.81456953642 3.16556291391 2.78145695364 2.38410596026 2.10596026490 1.70860927152 1.49668874172 4.59602649007 4.64900662252 4.03973509934 3.37748344371 2.92715231788 2.37086092715 2.21192052980 1.98675496689 1.69536423841 1.41721854305 4.33112582781 3.94701986755 3.49668874172 3.19205298013 2.76821192053 2.10596026490 1.81456953642 1.56291390728 1.32450331126]; 
cons60=2.81797722;
cons80=3.91048967;
cons120=8.79765621;
consvmax=15.01318082;

% 3*10^(-2)